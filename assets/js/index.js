"use strict";function _classCallCheck(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,o){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!o||"object"!=typeof o&&"function"!=typeof o?e:o}function _inherits(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);e.prototype=Object.create(o&&o.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(e,o):e.__proto__=o)}var showTooltipAndScroll=function(e,o){var r=e.closest(".form-group");r.hasClass("has-error")||(r.addClass("has-error"),r.append('<div class="form-error-message">'+o+"</div>")),$("html, body").animate({scrollTop:e.offset().top-100},600)},showTooltip=function(e,o){var r=e.closest(".form-group");r.hasClass("has-error")||(r.addClass("has-error"),r.append('<div class="form-error-message">'+o+"</div>"))},removeTooltip=function(e){var o=e.closest(".form-group");o.removeClass("has-error"),o.find(".form-error-message").remove()},$form_input=$("#work-form :input.is-required");$form_input.on("blur",function(){$.trim(this.value)?removeTooltip($(this)):showTooltip($(this),"本欄必填")});var has_fee_option=document.getElementById("has-fee-option"),clearHasFee=function(){has_fee_option.classList.remove("is-active");for(var e=has_fee_option.childNodes,o=0;o<e.length;o++)for(var r=0;r<e[o].childNodes.length;r++)"INPUT"===e[o].childNodes[r].nodeName&&(e[o].childNodes[r].checked=!1)};$('#select-fee :input[type="radio"]').on("change",function(){document.getElementById("fee_yes").checked?has_fee_option.classList.add("is-active"):clearHasFee()});for(var clear_radio_btn=document.querySelectorAll(".btn-radio-clear"),i=0;i<clear_radio_btn.length;i++)clear_radio_btn[i].addEventListener("click",function(){for(var e=this.parentNode.parentNode.childNodes,o=0;o<e.length;o++)for(var r=0;r<e[o].childNodes.length;r++)"INPUT"===e[o].childNodes[r].nodeName&&(e[o].childNodes[r].checked=!1);"select-fee"===this.parentNode.parentNode.id&&clearHasFee()});var isFacebookSignedIn=!1,$work_form=$("#work-form"),$work_form_submit_button=$("#submit"),ValidationError=function(e){function o(e,r){_classCallCheck(this,o);var t=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));return t.target=r,t}return _inherits(o,e),o}(Error),domToData=function(){return{company_id:$("#form-company-id").val(),company_query:$("#form-company-query").val(),job_title:$("#form-job-title").val(),sector:$("#form-sector").val(),day_promised_work_time:$("#form-day-promised-work-time").val(),day_real_work_time:$("#form-day-real-work-time").val(),week_work_time:$("#form-week-work-time").val(),overtime_frequency:$("#form-overtime-frequency input[name='frequency']:checked").val(),has_overtime_salary:$("#select-fee input[name='fee']:checked").val(),is_overtime_salary_legal:$("#has-fee-option input[name='has_pay']:checked").val(),has_compensatory_dayoff:$("#form-has-compensatory-dayoff input[name='time_off']:checked").val(),email:$("#form-email").val()}},checkFormField=function(){var e=domToData();if(e.company_query=$.trim(e.company_query),""===e.company_query)throw new ValidationError("需填寫公司/單位",$("#form-company-query"));if(e.job_title=$.trim(e.job_title),""===e.job_title)throw new ValidationError("需填寫職稱",$("#form-job-title"));if(""===e.day_promised_work_time)throw new ValidationError("需填寫工作日表定工作時間",$("#form-day-promised-work-time"));if(e.day_promised_work_time=parseFloat(e.day_promised_work_time),isNaN(e.day_promised_work_time))throw new ValidationError("工作日表定工作時間並非數字",$("#form-day-promised-work-time"));if(e.day_promised_work_time<0||e.day_promised_work_time>24)throw new ValidationError("工作日表定工作時間範圍為0~24小時",$("#form-day-promised-work-time"));if(""===e.day_real_work_time)throw new ValidationError("需填寫工作日實際工作時間",$("#form-day-real-work-time"));if(e.day_real_work_time=parseFloat(e.day_real_work_time),isNaN(e.day_real_work_time))throw new ValidationError("工作日實際工作時間並非數字",$("#form-day-real-work-time"));if(e.day_real_work_time<0||e.day_real_work_time>24)throw new ValidationError("工作日實際工作時間範圍為0~24小時",$("#form-day-real-work-time"));if(""===e.week_work_time)throw new ValidationError("需填寫一週總工時",$("#form-week-work-time"));if(e.week_work_time=parseFloat(e.week_work_time),isNaN(e.week_work_time))throw new ValidationError("一週總工時並非數字",$("#form-week-work-time"));if(e.week_work_time<0||e.week_work_time>168)throw new ValidationError("一週總工時範圍為0~168小時",$("#form-week-work-time"));if(!e.overtime_frequency||""===e.overtime_frequency)throw new ValidationError("需填寫加班頻率",$("#form-overtime-frequency"))},sendFormData=function(){var e=domToData();e.access_token=FB.getAccessToken(),e.company=e.company_query,delete e.company_query,e.day_promised_work_time=parseFloat(e.day_promised_work_time),e.day_real_work_time=parseFloat(e.day_real_work_time),e.week_work_time=parseFloat(e.week_work_time),$.ajax({url:WTS.constants.backendURL+"workings",method:"POST",data:e,dataType:"json"}).then(function(e){$work_form.trigger("sended",{data:e}),$work_form.trigger("submitted",{data:e})}).fail(function(e,o,r){$work_form_submit_button.prop("disabled",!1),$work_form.trigger("sended",{error:new Error,type:"SendError",jqXHR:e,textStatus:o,errorThrown:r}),$work_form.trigger("submitted",{error:new Error,type:"SendError",jqXHR:e,textStatus:o,errorThrown:r})})};$("#auth_check_text").hide(),$("#auth_check_reminder").hide(),$work_form.on("submit",function(e){e.preventDefault(),$work_form_submit_button.prop("disabled",!0),$work_form.trigger("submitting");try{checkFormField()}catch(e){return $work_form_submit_button.prop("disabled",!1),void $work_form.trigger("submitted",{error:e,type:"ValidationError"})}isFacebookSignedIn?sendFormData():FB.login(function(e){statusChangeCallback(e),"connected"===e.status?sendFormData():($work_form_submit_button.prop("disabled",!1),$work_form.trigger("submitted",{error:new Error("未登入FB，取消送出資料"),type:"AuthError"}))},{scope:"public_profile,email"})});var auth_check_reminder_timer=null,auth_check_reminder_latency=3e3;$work_form.on("submitting",function(e){$("#submit_text").hide(),$("#auth_check_text").show(),auth_check_reminder_timer=setTimeout(function(){$("#auth_check_reminder").show("slow")},auth_check_reminder_latency)}),$work_form.on("submitted",function(e,o){if($("#submit_text").show(),$("#auth_check_text").hide(),clearTimeout(auth_check_reminder_timer),$("#auth_check_reminder").hide("slow"),o.error)return void("ValidationError"===o.type?showTooltipAndScroll(o.error.target,o.error.message):"AuthError"===o.type?showAlert("alert","Facebook 登入失敗","為了避免使用者大量輸入假資訊，我們會以您的 Facebook 帳戶做驗證。但別擔心！您的帳戶資訊不會以任何形式被揭露、顯示。每一帳戶目前僅能上傳 5 次工時資訊。","go-fb-login"):"SendError"===o.type&&(0===o.jqXHR.readyState?showAlert("alert","Oops 有些錯誤發生","請查看你的網路連線再試一次！","go-to-form"):4===o.jqXHR.readyState?showAlert("alert","Oops ",o.jqXHR.responseJSON.message,"go-to-form"):showAlert("alert","Oops 有些錯誤發生","請查看你的網路連線再試一次！","go-to-form")));var r=5,t=o.data.queries_count;showAlert("success","上傳成功","您已經上傳 "+t+" 次，還有 "+(r-t)+" 次可以上傳。","go-to-show")}),window.fbAsyncInit=function(){var e="localhost"===window.location.hostname?"1750608541889151":"1750216878594984";FB.init({appId:e,cookie:!0,xfbml:!0,version:"v2.6"}),FB.getLoginStatus(function(e){statusChangeCallback(e)})};var statusChangeCallback=function(e){"connected"==e.status?(isFacebookSignedIn=!0,document.querySelector(".fb-login-word").style.display="none",document.querySelector(".btn-why-facebook-login").style.display="none"):(isFacebookSignedIn=!1,document.querySelector(".fb-login-word").style.display="",document.querySelector(".btn-why-facebook-login").style.display="")};!function(e,o,r){var t,a=e.getElementsByTagName(o)[0];e.getElementById(r)||(t=e.createElement(o),t.id=r,t.src="//connect.facebook.net/zh_TW/sdk.js",a.parentNode.insertBefore(t,a))}(document,"script","facebook-jssdk"),$(function(){var e=[],o=[];$.ajax({url:WTS.constants.backendURL+"workings/latest",dataType:"json"}).done(function(r){e=Array.from(new Set($.map(r.workings,function(e,o){return{value:e.job_title}}))).slice(0,4),o=Array.from(new Set($.map(r.workings,function(e,o){return{value:e.company.name,company_id:e.company.id}}).filter(function(e){return void 0!==e.company_id}))).slice(0,4)});var r=function(){$(this).autocomplete("search",$(this).val())},t=function(e,o){var r=$(e.currentTarget).find(".ui-state-active");r.parent().hasClass("ui-state-disabled")&&(e.preventDefault(),r.parent().siblings().first().children("div").mouseenter())},a=function(e,o){var r=$("<li>").append($("<div>").text(o.label));return o.disabled&&r.addClass("ui-state-disabled"),r.appendTo(e)},n=$("#form-job-title"),i=$("#form-company-query");n.autocomplete({source:function(o,r){return n.trigger("autocomplete-search",o.term),0==o.term.length?void r([{value:"最近被填寫的職位",disabled:!0}].concat(e.map(function(e){return e.disabled=!1,e}))):void $.ajax({url:WTS.constants.backendURL+"jobs/search",data:{key:o.term},dataType:"json"}).done(function(e){var o=$.map(e,function(e,o){return{value:e.des,id:e._id}});r(o)}).fail(function(e,o){r([])})},minLength:0,select:function(e,o){n.trigger("autocomplete-select",o.item.label)},focus:t}).focus(r).data("ui-autocomplete")._renderItem=a,$("#form-company-query").autocomplete({source:function(e,r){return i.trigger("autocomplete-search",e.term),e.term.length<2?void r([{value:"最近被填寫的公司",disabled:!0}].concat(o.map(function(e){return e.disabled=!1,e}))):void $.ajax({url:WTS.constants.backendURL+"companies/search",data:{key:e.term},dataType:"json"}).done(function(e){var o=[];e.forEach(function(e,r){o.push({value:e.name,company_id:e.id})}),r(o)}).fail(function(e,o){r([])})},minLength:0,select:function(e,o){i.trigger("autocomplete-select",o.item.company_id),$("#form-company-id").val(o.item.company_id)},focus:t}).focus(r).data("ui-autocomplete")._renderItem=a});var formBeginTime=null,formSubmittedTime=null,hasSendedFormWritingTime=!1;$(function(){!function(){function e(e){o||(o=!0,$("#work-form").trigger("beginWriting"))}var o=!1;$("#work-form input").on("focus",e),$("#work-form input").on("click",e),$("#work-form input[type=radio]").on("change",e)}()}),$work_form.one("beginWriting",function(e){formBeginTime=performance.now(),ga&&ga("send","timing","LANDING_PAGE","form-begin-writing",formBeginTime)}),$work_form.on("submitted",function(e,o){if(!o.error&&!hasSendedFormWritingTime){formSubmittedTime=performance.now();var r=formSubmittedTime-formBeginTime;ga&&ga("send","timing","LANDING_PAGE","form-submitted",formSubmittedTime),ga&&ga("send","timing","LANDING_PAGE","form-writing",r),hasSendedFormWritingTime=!0}}),$work_form.on("submit",function(e){ga&&ga("send","event","LANDING_PAGE","click-submit")});var $fb_share_button=$("#fb-share-button"),$twitter_share_button=$("#twitter-share-button");$fb_share_button.on("click",function(e){ga&&ga("send","event","LANDING_PAGE","click-fb-share")}),$twitter_share_button.on("click",function(e){ga&&ga("send","event","LANDING_PAGE","click-twitter-share")}),$work_form.on("submitted",function(e,o){o.error?"ValidationError"===o.type?ga&&ga("send","event","LANDING_PAGE","check-form-fail",o.error.message):"AuthError"===o.type?ga&&ga("send","event","LANDING_PAGE","upload-fail",o.error.message):"SendError"===o.type&&(0===o.jqXHR.readyState?ga&&ga("send","event","LANDING_PAGE","upload-fail","readyState:"+o.jqXHR.readyState):4===o.jqXHR.readyState?ga&&ga("send","event","LANDING_PAGE","upload-fail",o.jqXHR.responseJSON.message):ga&&ga("send","event","LANDING_PAGE","upload-fail",o.error.message)):ga&&ga("send","event","LANDING_PAGE","upload-success")});var $job_title=$("#form-job-title"),$company_query=$("#form-company-query");$job_title.on("autocomplete-search",function(e){ga&&ga("send","event","LANDING_PAGE","job-title-autocomplete-search",e)}),$job_title.on("autocomplete-select",function(e){ga&&ga("send","event","LANDING_PAGE","job-title-autocomplete-select",e)}),$company_query.on("autocomplete-search",function(e){ga&&ga("send","event","LANDING_PAGE","company-query-autocomplete-search",e)}),$company_query.on("autocomplete-search",function(e){ga&&ga("send","event","LANDING_PAGE","company-query-autocomplete-select",e)});